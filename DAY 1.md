# DAY 1

## RSA_BASE

### d_leak

#### 思路

关于这道题，我的想法起初和Deebato是一样的，后来想过能否不求出$$\phi$$而解出这个问题，但想了半天之后还是没有思路QAQ，但我转念一想，这道题似乎把一组基本的加解密实例给我了，于是我就想起了之前在学RSA时看到的一篇博文，是关于n,e,d都泄露的攻击方式，一试发现居然成功了ouo

首先，我们知道
$$
\varphi =(p-1) * (q-1)
$$
接着，我们又知道
$$
\because ed + \varphi y =1
$$

$$
\therefore \varphi y=ed-1
$$

$$
\therefore 假设有一个数x(x<n),则x^{ed-1} \equiv x^{\varphi y} \equiv 1 (mod n)
$$

$$
\therefore n|x^{ed-1}-1
$$

$$
\therefore pq|x^{ed-1}-1
$$

显然 $ed-1=y(p-1)(q-1)$ 则ed-1为偶数


$$
\therefore 不妨设ed-1=2^k*t
$$

$$
\therefore x^{2^k*t}-1=(x^t-1)(x^t+1)(x^{2t}+1)\dots(x^{2^{k-1}*t}+1) \tag{8}
$$

所以p和q一定为这些因式中的一个或多个因式的因子，那么我们就可以通过将$x^{2^{k-1}*t}-1,x^{2^{k-2}*t}-1,x^{2^{k-3}*t}-1\dots (x^t-1)$ 与n进行取模运算，如果得到的余数$res!=0且gcd(res,n)>1$,那么说明res中含有因子p或q,则$gcd(res,n)==p或q$,那么n便可以被分解了，如果上述条件均不满足，则再随机选个数x重复上述操作

#### 一些小思考

以下是我对博文中所述的(8)式的思考：

1.显然不可能对（8）式进行取模，因为（6）

2.为何不对其中的$x^s+1$进行取模,而是对$x^s-1$进行取模

​			因为显然p,q均为质数，那么他们必在因式$(x^t-1),(x^t+1),(x^{2t}+1),\dots,(x^{2^{k-1}*t}+1)$ 之中，假设p和q都在$(x^{2^{k-1}*t}+1)$

中，则设其为$pqr$ ,显然对其取模也是不行的，而分解出的另一式$(x^{2^{k-1}*t}-1)=pqr-2$ ，则$pqr-2 \mod pq==pq-2$,而$gcd(pq-2,pq)==1$，因此应继续分解$(x^{2^{k-1}*t}-1)$为$(x^{2^{k-2}*t}-1)$ 和$(x^{2^{k-2}*t}+1)$,若p和q都在$(x^{2^{k-2}*t}+1)$,则情形与上述一致，否则，若pq全在$(x^{2^{k-2}*t}-1)$ ，则同理难以得出p或q,但由于$(x^{2^{k-2}*t}-1)$的可拆分性，是有可能可以将p和q分开进不同的因式的，此时将那个式子记作$pr(gcd(r,q)==1,iq<r<(i+1)q)$,则$pr \mod pq ==(r-iq)p$此时则含有p，而$gcd(r-iq,q)==1$ ，所以$gcd((r-iq)p,n)==p$,则p可得出，那么$q=n\div p$,从而我们便可以去快乐地计算$\varphi$了ouo！！！

### code

```python
from Crypto.Util.number import *
from gmpy2 import *
import random
c1 =  4672466920489152663456032326874857932220483262979534897448613308214578507243824452374163370166934249093431313399941721809510330816793178745906984726699615151217481335662191265737389665985082803005924368282914471096284386661581188329110030310396886528567602302081402650372755390585276592280702433720687684783647280489473337425986039671207139629549397100771022237694776824434411148393787053119087973808103864369918847330028070022287724385876037793281907460364619935411552339055231183363832503487995458744140341604095205104597021448183862002706606859444029629881651595070248556308402182854554232202314691005205573895817
c2 =  11762007672829309303783584164637762028426131801627140626296552393907735467901832289643467912770809750531632496714109396925143058729447286501984210800993497912638371728742280290653239170160191918902604293387130890600507044348182579041568788605009552415290748068132939557999852389590200522411372147985438446498402074816946669607662044197649446531954880679363820713919849435842414086352936901770816411616479264846679027346266395155410117461274277065666508780105709410331506636583427414134029396799172531192936344201970185888300034111245325212590363609105400702819991984649451782853860788946347786558751526361196953386288
e1 = 65537
e2 = 65539
n =  27045264462883226976383360322030320653260210257177979317847738239117093721841047692633458647288143453328344210261656796573183552848849627286533574515608603829081278967225181535900806995020971300191735414309465748506076279816888610794266982692464162331506907229571878564624961574722861760684320379978251943294499964882722207550543043217884893667892137418417905070124155127151066869659307557967452414821016231724701533008698790434935135351277017912643668481021905999909139908196187415987885097038567310086894424334506400839651703666745542871216945755826410332788712937187506722910572501285794478940911032845585247111327
gift = 14865259570654433406217577941013110312826941939424526160604104961311563697577829622717586209204167164743482538749796315457821046747963154769298448528331372005602420479383943257796647230948096925027186064272938571992704575301950982468393201558630148702344352231924534379891059490740603420104224922220678265732984873518632208250946659893465547317653051043361878313439796238889640797431926941014985995279474416395258463997908393730922994541028169817451996769676396548857559980582748902382200693478812847431216168825231769690867638599214996146138779397259339100868845329130334484404514160017659377771448825657042974335633
def getpq(n,e,d):
    while 1:
        k = e * d - 1
        x = random.randint(0, n)
        while k%2==0:
            k=k//2
            res=powmod(x,k,n)-1
            if gcd(res,n)>1 and res!=0:
                return gcd(res,n)
p=getpq(n,e1,gift)
q=n//p
#print("q:",p)
#print("p:",q)
phi=(p - 1) * (q - 1)
d2=invert(e2,phi)
#print("d2:",d2)
m2=powmod(c2,d2,n)
#print("m2:",m2)
flag=long_to_bytes(m2)
print(flag)


```

### The end